<h3 class="header-title">
    {{'User Management' | translate}}
</h3>

<div class="container-fluid">

    <!-- List Page -->
    <div [hidden]="showAddForm || showEditForm">
        <!-- Search/Add Bar -->
        <div class="row">
            <div class="col-sm-12">
                <div class="align-items-center d-flex row">
                    <div class="col-6">
                        <mat-form-field appearance="fill">
                            <mat-label>{{ "Search" | translate }}</mat-label>
                            <input matInput #search placeholder="Type" (keyup)="applyFilter($event)" [id]="'search'" />
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <div class="text-right">
                            <button mat-raised-button appearance="fill" class="m-1 color-blue" [id]="'add'"
                                (click)="showAddFormPage()">
                                {{ "Add" | translate }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- List -->
        <div class="mat-elevation-z8">
            <!-- <table mat-table matSort> -->
            <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)">
                <!-- User Name -->
                <ng-container matColumnDef="userName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "User Name" | translate }}</th>
                    <td mat-cell *matCellDef="let element" class="text-left">{{
                        element.userName }}</td>
                </ng-container>
                <!-- First Name -->
                <ng-container matColumnDef="firstName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "First Name" | translate }}</th>
                    <td mat-cell *matCellDef="let element" class="text-left">{{
                        element.firstName }}</td>
                </ng-container>
                <!-- Last Name -->
                <ng-container matColumnDef="lastName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "Last Name" | translate }}</th>
                    <td mat-cell *matCellDef="let element" class="text-left">{{
                        element.lastName }}</td>
                </ng-container>
                <!-- Email -->
                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "Email" | translate }}</th>
                    <td mat-cell *matCellDef="let element" class="text-left">{{
                        element.email }}</td>
                </ng-container>
                <!-- Last Log In -->
                <ng-container matColumnDef="lastLogin">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "Last Log In" | translate }}</th>
                    <td mat-cell *matCellDef="let element" class="text-center">{{
                        element.lastLogin+'Z' | date: 'medium' }}</td>
                </ng-container>
                <!-- International Users -->
                <ng-container matColumnDef="internationalUsers">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        {{ "International Users" | translate }}</th>
                    <td mat-cell *matCellDef="let element" class="text-left">{{
                        element.internationalUsers }}</td>
                </ng-container>
                <!-- Action -->
                <ng-container matColumnDef="Action">
                    <tr>
                        <th mat-header-cell *matHeaderCellDef class="text-center">
                            {{'Action' | translate}}</th>
                    </tr>
                    <tr>
                        <td mat-cell *matCellDef="let element" class="text-center">
                            <button mat-icon-button color="dark-grey" title="{{'Edit' | translate }}" [id]="'edit'"
                                (click)="editIconClicked(element.id)">
                                <mat-icon class="edit-blue">edit</mat-icon>
                            </button>
                            <button mat-icon-button color="dark-grey" [id]="'Disable'" *ngIf="element.userEnabled"
                                (click)="toggleAgency(element.id, element.userEnabled)"
                                title="{{'Disable' | translate }}">
                                <mat-icon class="color-red">block</mat-icon>
                            </button>

                            <button mat-icon-button color="dark-grey" [id]="'Enable'" *ngIf="!element.userEnabled"
                                (click)="toggleAgency(element.id, element.userEnabled)"
                                title="{{'Enable' | translate }}">
                                <mat-icon class="color-green">done_outline</mat-icon>
                            </button>
                        </td>
                    <tr>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
            <div class="col-sm-12 text-center" [hidden]="dataSource.filteredData?.length !== 0">
                {{'No records found' | translate}}</div>
            <mat-paginator [pageSizeOptions]="[10, 20, 50, 100]" showFirstLastButtons [id]="'page'"
                aria-label="Select page of periodic elements">
            </mat-paginator>
        </div>
    </div>

    <!-- Add/Edit(temp) User Page -->
    <div *ngIf="showAddForm || showEditForm">
        <form [formGroup]="userManageForm" (ngSubmit)="addUser(userManageForm.value)">
            <div class="row">
                <!-- Email -->
                <div class="col-md-6">
                    <mat-form-field appearance="fill" class="w-100" [disabled]="showEditForm"
                        [ngClass]="showEditForm === true ? 'disable-field pb-0 border-bottom-black' : ''">
                        <mat-label>{{'Email' | translate}}</mat-label>
                        <input matInput type="text" [id]="'email'" formControlName="email" tabindex="-1" />
                        <!-- ERRORS -->
                        <mat-error *ngIf="userManageForm.get('email')?.hasError('required')" [id]="'erroremail1'">
                            {{ 'Email is Required' | translate }}
                        </mat-error>
                        <mat-error *ngIf="userManageForm.get('email')?.hasError('email')" [id]="'erroremail2'">
                            {{ 'Please enter a valid Email' | translate }}
                        </mat-error>
                        <mat-error *ngIf="userManageForm.get('email')?.hasError('invalid')" [id]="'erroremail3'">
                            {{ userManageForm.get('email')?.getError('invalid') | translate }}
                        </mat-error>
                        <!-- ERRORS -->
                    </mat-form-field>
                </div>
                <!-- Available Users -->
                <div class="col-md-6">
                    <mat-form-field appearance="fill" class="w-100" [disabled]="showEditForm"
                        [ngClass]="showEditForm === true ? 'disable-field pb-0 border-bottom-black' : ''">
                        <mat-label>{{"Available Users" | translate}}</mat-label>
                        <mat-select formControlName="avUser" [id]="'avUser'" (selectionChange)="avUserSelect($event)"
                            tabindex="-1">
                            <mat-option *ngFor="let user of userList" [value]="user.email">{{user.email}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="align-items-end col-md-12 mb-4 d-flex justify-content-end">
                        <button type="button" mat-raised-button class="m-1 color-blue" [id]="'copy'"
                            [disabled]="disableCopy" [ngClass]="disableCopy === true ? 'disable-field' : ''"
                            style="color: white" (click)="getAvUserRole(selectedCopyUser)">
                            {{'Copy User' |translate}}
                        </button>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- First Name -->
                <div class="col-md-6">
                    <mat-form-field appearance="fill" class="w-100">
                        <mat-label>{{'First Name' | translate}}</mat-label>
                        <input matInput type="text" [id]="'fname'" formControlName="fname" maxlength="20" />
                        <!-- ERRORS -->
                        <mat-error *ngIf="userManageForm.get('fname')?.hasError('required')" [id]="'errorfname'">
                            {{ 'First Name is Required' | translate }}
                        </mat-error>
                        <!-- ERRORS -->
                    </mat-form-field>
                </div>
                <!-- Last Name -->
                <div class="col-md-6">
                    <mat-form-field appearance="fill" class="w-100">
                        <mat-label>{{'Last Name' | translate}}</mat-label>
                        <input matInput type="text" [id]="'lname'" formControlName="lname" maxlength="20" />
                        <!-- ERRORS -->
                        <mat-error *ngIf="userManageForm.get('lname')?.hasError('required')" [id]="'errorlname'">
                            {{ 'Last Name is Required' | translate }}
                        </mat-error>
                        <!-- ERRORS -->
                    </mat-form-field>
                    <!-- International Users checkbox -->
                    <mat-checkbox color="primary" id='intUserCheck' formControlName="intUserCheck"
                        [disabled]="showEditForm" [ngClass]="showEditForm === true ? 'disable-field' : ''">
                        {{"International Users" | translate}}
                    </mat-checkbox>
                </div>
            </div>
            <div class="row">
                <!-- Contracts -->
                <div class="col-md-6 mt-0" style="margin-top: -4px;">
                    <!-- <mat-form-field appearance="fill" class="w-100"> -->
                    <mat-label>{{'Contracts' | translate}}</mat-label>
                    <!-- <input tabindex="-1" matInput type="text" [id]="'contracts'" formControlName="contracts" /> -->
                    <ng-select [attr.id]="'contracts' + contractRoles.contractName" [items]="contractRoles"
                        bindLabel="contractName" formControlName="contracts"
                        [ngClass]="{ 'is-invalid': userManageForm.get('contracts')?.invalid && userManageForm.get('contracts')?.touched }"
                        placeholder="{{'Select a Contract'| translate}}" appendTo="body" [multiple]="true"
                        [(ngModel)]="selectedContract" [searchable]="true" bindValue="contractsID"
                        (selected)="selectContract($event)">
                    </ng-select>
                    <!-- ERRORS -->
                    <div *ngIf="userManageForm.get('contracts')?.invalid && userManageForm.get('contracts')?.touched">
                        <mat-error class="pt-1 pl-2" *ngIf="userManageForm.get('contracts')?.hasError('required')" [id]="'error_contracts'">
                            {{ 'Contract is Required' | translate }}
                        </mat-error>
                    </div>
                    <!-- ERRORS -->
                </div>
                <!-- System Roles -->
                <div class="col-md-6">
                        <mat-label>{{'System Roles' | translate}}</mat-label>
                        <ng-select [attr.id]="'sysRoles' + sysRoles.name" [items]="sysRoles"
                        bindLabel="name" formControlName="sysRoles" [disabled]="showEditForm"
                        [ngClass]="{ 'is-invalid': userManageForm.get('sysRoles')?.invalid && userManageForm.get('sysRoles')?.touched }"
                        placeholder="{{'Select a Role'| translate}}" appendTo="body" [multiple]="true"
                        [(ngModel)]="selectedRole" [searchable]="true" bindValue="rolesId"
                        (change)="sysRoleSelect($event)"> 
                        </ng-select>
                        <!-- ERRORS -->
                        <div *ngIf="userManageForm.get('sysRoles')?.invalid && userManageForm.get('sysRoles')?.touched">
                        <mat-error class="pt-1 pl-2" *ngIf="userManageForm.get('sysRoles')?.hasError('required')" [id]="'error_sysRoles'">
                            {{ 'System Roles is Required' | translate }}
                        </mat-error>
                        </div>
                        <!-- ERRORS -->
                    <!-- </mat-form-field> -->
                </div>
            </div>
            <div class="row">
                <div class="align-items-end col-md-12 mb-4 d-flex justify-content-end">
                    <button mat-raised-button class="m-1 color-blue" [id]="'cancel'"
                        (click)="cancelAdd_Save()">{{'Cancel'|
                        translate}}</button>
                    <button mat-raised-button class="m-1 color-blue" [id]="'addForm'" type="submit" *ngIf="showAddForm">
                        {{'Add' |translate}}</button>
                    <button type="button" mat-raised-button class="m-1 color-blue" [id]="'save'" *ngIf="showEditForm"
                        (click)="updateUserRole(userManageForm.value)">
                        {{'Save' |translate}}
                    </button>
                </div>
            </div>

        </form>
    </div>

    <!-- Edit User Page - to be implemented later -->
    <!-- <div class="container-fluid">
        <div *ngIf="showEditForm">
            <div class="ivr-card mb-3">
                <h4 class="blacked-title">User Setting</h4>
                <ul class="m-0 mt-2 pl-10">
                    <li class="onOff-toggle">
                        <span>
                            <span>Turn</span>
                            <div class="custom-switch custom-switch-label-onoff">
                                <input class="custom-switch-input" id="btn1" type="checkbox">
                                <label class="custom-switch-btn" for="btn1"></label>
                            </div>
                            Force Password Change on Next Log In
                            <span></span>
                        </span>
                    </li>
                    <li class="onOff-toggle">
                        <span>
                            <span>Turn</span>
                            <div class="custom-switch custom-switch-label-onoff">
                                <input class="custom-switch-input" id="btn2" type="checkbox">
                                <label class="custom-switch-btn" for="btn2"></label>
                            </div>
                            Force Security Question Change on Next Log In
                            <span></span>
                        </span>
                    </li>
                    <li class="onOff-toggle">
                        <mat-checkbox color="primary">International Users</mat-checkbox>
                    </li>
                </ul>
            </div>
            <div class="ivr-card">
                <h4 class="blacked-title">User Roles</h4>
                <ul class="m-0 mt-2 pl-10 userRoleBox">
                    <li class="onOff-toggle" *ngFor="let item of list">
                        <span>
                            <span>Turn</span>
                            <div class="custom-switch custom-switch-label-onoff">
                                <input class="custom-switch-input" [id]="'role'+item.id" type="checkbox">
                                <label class="custom-switch-btn" [for]="'role'+item.id"></label>
                            </div>
                            {{item.name}}
                            <span></span>
                        </span>
                    </li>
                </ul>
            </div>
            <div class="row">
                <div class="align-items-end col-md-12 mb-4 d-flex justify-content-end">
                    <button mat-raised-button class="m-1 color-blue" [id]="'cancelSave'"
                        (click)="cancelAdd_Save()">{{'Cancel'|
                        translate}}</button>
                    <button type="button" mat-raised-button class="m-1 color-blue" [id]="'save'"
                        (click)="updateUserRole(dispositionCodeForm.value)">
                        {{'Save' |translate}}
                    </button>
                </div>
            </div>
        </div>
    </div> -->

</div>